<!DOCTYPE html>
<html lang="en">

<head>
<title>React Native: 配置和起步 |  Yet Another Summer Rain</title>
<meta charset='utf-8' />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="liaohuqiu@gmail.com 廖祜秋" />
<meta name="description" content="" />
<meta name="keywords" content="" />

<meta name="google-site-verification" content="SbAzRqb2cWqPDNEITWdNn-OnF4w_dWNJgt37GYC3kqY" />

<!-- Documentation extras -->
<!--[if lt IE 9]><script src="/assets/compatibility/ie8-responsive-file-warning.js"></script><![endif]-->

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="/assets/compatibility/html5shiv-3.7.0.js"></script>
  <script src="/assets/compatibility/respond-1.4.2.js"></script>
<![endif]-->

<script src="/assets/app/js/base.js?3bf6b087b1e32d405411100461492601"></script>
<link href="/assets/app/css/app.css?4473b56a8ccee4b4e3a773e526023dba" rel="stylesheet">
<script src="/assets/app/js/app.js?4473b56a8ccee4b4e3a773e526023dba"></script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
try {
    ga('create', 'UA-43024238-1', 'liaohuqiu.net');
    ga('send', 'pageview');
} catch(err) {
    console.log(err);
}
</script>
</head>

<body>

<header id="header">
  <div class='site-container'>
    <div class='mobile-nav-toggle mobile-display'>
      <div class='bar top-bar'></div>
      <div class='bar middle-bar'></div>
      <div class='bar bottom-bar'></div>
    </div>
    <div class='header-logo-container'>
      <h1 id="site_title"><a href="/">Srain</a></h1>
      
      <a>质有高低，境界不同。</a>
      
    </div>
    <div class='desktop-menu desktop-display'>
      
<ul class="header-menu" role="menuigation">
  <li class="header-menu-item">
  <a class="header-menu-link" href="/">English posts</a>
  </li>
  <li class="header-menu-item">
  <a class="header-menu-link" href="/about/about-me">About</a>
  </li>
  <li class="header-menu-item">
  <a class="header-menu-link" href="/about/friends">Friends</a>
  </li>
  <li class="header-menu-item">
  <a class="header-menu-link" href="/about/feed">Feed</a>
  </li>
</ul>


    </div>
  </div>
  <div class='mobile-menu mobile-display'>
    
<ul class="header-menu" role="menuigation">
  <li class="header-menu-item">
  <a class="header-menu-link" href="/">English posts</a>
  </li>
  <li class="header-menu-item">
  <a class="header-menu-link" href="/about/about-me">About</a>
  </li>
  <li class="header-menu-item">
  <a class="header-menu-link" href="/about/friends">Friends</a>
  </li>
  <li class="header-menu-item">
  <a class="header-menu-link" href="/about/feed">Feed</a>
  </li>
</ul>


  </div>
</header>


<!-- MAIN CONTENT -->
<div class='post'>
    <div id="main_content_wrap" class="outer">
        <div class="md-body main-content inner wide">
            <!--
            
            <div class="alert alert-warning" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                
                <strong><a target='_blank' href='/cn/posts/follow-me-on-github/'>一事相求, 还望相助：请在 GitHub 上关注我吧!</a></strong>
                
            </div>
            
            --->
            <h2> React Native: 配置和起步 </h2>
            <div>
                <p> 23 Sep 2015 </p>
            </div>
            <hr>
            <p>2015 年 9 月 15 号，React Native for Android 发布。至此，React 基本完成了对多端的支持。基于 React / React Native 可以：</p>

<ul>
<li><p>H5, Android, iOS 多端代码复用</p></li>
<li><p>实时热部署</p></li>
</ul>

<p>在接下来的时间，我会通过一系列文章来介绍 React Native。本文介绍环境配置以及如何建立一个简单的项目。本篇文章 iOS 和 Android 开发都适用。</p>

<p>目前使用 React Native 开发<strong>只能在 Mac 系统</strong> 上进行。写 iOS 的同学，应该都是 Mac （除了听说网易有些部门写 iOS 给黑苹果之外，哈哈哈哈）。 开发 Android 的同学, 如果公司配发的不是 Mac 的话，建议自己入手一个，能显著提高生产力，就当投资自己吧。我大阿里对 Android 开发也是不给 Mac 的（不知道公司什么思路，现在倒是可以申请 Mac air了，air的性能……），所以我也是自己买的。</p>

<h3 id="环境配置">环境配置</h3>

<p>需要安装的有:</p>

<ul>
<li><p><a href="http://brew.sh/">Homebrew</a></p>

<p><a href="http://brew.sh/">Homebrew</a> 是 Mac 中的一个包管理器。没有安装的话，<a href="http://brew.sh/">点击这里安装</a> 我的版本如下:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">mac-2:~ srain<span class="nv">$ </span>brew -v
Homebrew 0.9.5 <span class="o">(</span>git revision ac9a7<span class="p">;</span> last commit 2015-09-21<span class="o">)</span>
</code></pre></div>
<p>版本过低将会导致无法安装后续几个组件。可用  <code>brew update</code> 升级。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">mac-2:react-native srain<span class="nv">$ </span>brew update
Updated Homebrew from ac9a71c8 to 4257c3da.
</code></pre></div></li>
<li><p><a href="https://nodejs.org/">Node.js</a> 和 <a href="https://docs.npmjs.com/">npm</a></p>

<p><a href="https://nodejs.org/">Node.js</a> 需要 <code>4.0</code> 及其以上版本。安装好之后，<a href="https://docs.npmjs.com/">npm</a> 也有了。</p>

<ul>
<li><p>通过 <a href="https://github.com/creationix/nvm#installation">nvm</a> 安装 <a href="https://nodejs.org/">Node.js</a></p>

<p><a href="https://github.com/creationix/nvm#installation">nvm</a> 是 <a href="https://nodejs.org/">Node.js</a> 的版本管理器，可以轻松安装各个版本的 <a href="https://nodejs.org/">Node.js</a> 版本。</p>

<p>安装 <a href="https://github.com/creationix/nvm#installation">nvm</a> 可以通过 <a href="http://brew.sh/">Homebrew</a> 安装:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">brew install nvm
</code></pre></div>
<p>或者 <a href="https://github.com/creationix/nvm#installation">按照这里的方法</a> 安装。</p>

<p>然后安装 <a href="https://nodejs.org/">Node.js</a>：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">nvm install node <span class="o">&amp;&amp;</span> nvm <span class="nb">alias </span>default node
</code></pre></div></li>
<li><p>也可以直接下载安装 <a href="https://nodejs.org/">Node.js</a>： <a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a></p></li>
</ul>

<p>安装好之后，如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">mac-2:react-native srain$ node -v
v4.0.0
mac-2:react-native srain$ npm -v
2.14.2
</code></pre></div></li>
<li><p>安装 <a href="https://facebook.github.io/watchman/docs/install.html">watchman</a> 和 <a href="http://www.flowtype.org/">flow</a></p>

<p>这两个包分别是监控文件变化和类型检查的。安装如下：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">brew install watchman
brew install flow
</code></pre></div></li>
</ul>

<h3 id="安装-react-native">安装 React-Native</h3>

<p>通过 <a href="https://docs.npmjs.com/">npm</a> 安装即可：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install -g react-native-cli
</code></pre></div>
<h3 id="app-开发环境的设置">APP 开发环境的设置</h3>

<ul>
<li><p>iOS </p>

<p>XCode 6.3 及其以上即可。</p></li>
<li><p>Android </p>

<p>这个比较麻烦。</p>

<ul>
<li><p>设置环境变量：<code>ANDROID_HOME</code></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">ANDROID_HOME</span><span class="o">=</span>/usr/local/opt/android-sdk
</code></pre></div></li>
<li><p>SDK Manager 安装以下包：</p>

<p>Android SDK Build-tools version 23.0.1</p>

<p>Android 6.0 (API 23)</p>

<p>Android Support Repository</p></li>
</ul></li>
</ul>

<h3 id="初始化一个项目">初始化一个项目</h3>

<p>文档提到：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">react-native init AwesomeProject
</code></pre></div>
<p>初始化一个项目，其中 <code>AwesomeProject</code> 是项目名字，这个随意。等待<strong>一段时间之后</strong>（具体视网络情况而定），项目初始化完成。</p>

<p>进入到项目目录：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd </span>AwesomeProject
mac-2:AwesomeProject srain<span class="nv">$ </span>ls -l
total 24
drwxr-xr-x  <span class="m">14</span> srain  staff   <span class="m">476</span> Sep <span class="m">21</span> 09:52 android
-rw-r--r--   <span class="m">1</span> srain  staff  <span class="m">1023</span> Sep <span class="m">21</span> 11:47 index.android.js
-rw-r--r--   <span class="m">1</span> srain  staff  <span class="m">1065</span> Sep <span class="m">20</span> 11:58 index.ios.js
drwxr-xr-x   <span class="m">6</span> srain  staff   <span class="m">204</span> Sep <span class="m">20</span> 11:58 ios
drwxr-xr-x   <span class="m">5</span> srain  staff   <span class="m">170</span> Sep <span class="m">21</span> 10:31 node_modules
-rw-r--r--   <span class="m">1</span> srain  staff   <span class="m">209</span> Sep <span class="m">20</span> 11:58 package.json
</code></pre></div>
<p>其中 <code>android</code> 和 <code>ios</code> 中分别为两个平台的项目文件。<code>index.android.js</code> 和 <code>index.ios.js</code> 为两个页面对应的 js 文件。</p>

<h3 id="运行项目">运行项目</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text">不管是 iOS 还是 Android，在开发调试阶段，都需要在 Mac 上启动一个 HTTP 服务，称为`Debug Server`，默认运行在 8081 端口，APP 通 Debug Server 加载 js。

iOS 和 Android 的模拟器，连接 Mac 本机的服务都很方便。但是通过 USB 或者 Wifi 连接调试，就稍微麻烦一些了。
</code></pre></div>
<ul>
<li><p>iOS </p>

<p>还是非常简单，XCode 打开项目，点击运行就好。修改 <code>index.ios.js</code>, 在模拟器中 <code>⌘ + R</code> 重新载入 js 即可看到相应的变化。</p>

<p>iOS 真机调试也简单，修改HTTP地址即可。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">jsCodeLocation = [NSURL URLWithString:@&quot;http://localhost:8081/index.ios.bundle&quot;];
</code></pre></div></li>
<li><p>Android</p>

<p>按照官方文档，需要一个模拟器（Genymotion模拟器也可以）。但是不像 iOS，Android 开发平时更多是直接用真机进行开发和调试，如何运行部署到真机，下面会提到。</p>

<p>运行命令</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">react-native run-android
</code></pre></div>
<p>然后就会部署到模拟器，修改 <code>index.android.js</code> ，调出模拟器菜单键，选择重新载入 js 即可看到变化。</p></li>
<li><p>Android 真机调试</p>

<p>示例 APP 直接部署到真机，红色界面报错，无法连接到 Debug Server。</p>

<p>如果是 5.0 或者以上机型，可通过 adb 反向代理端口，将 Mac 端口反向代理到测试机上。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">adb reverse tcp:8081 tcp:8081
</code></pre></div>
<p>如果 5.0 以下机器，应用安装到测试机上之后，摇动设备，在弹出菜单中选择 Dev Setting &gt; Debug Server host for device，然后填入 Mac 的 IP 地址（<code>ifconfig</code> 命令可查看本机 IP）</p>

<blockquote>
<p>关于修改 DevHelper 来进行和 iOS 一样的开发调试，后续关于热部署时，我会介绍到。</p>
</blockquote></li>
<li><p>在 Android Studio 中调试开发</p>

<p>我们可能希望在 Android Studio 打开项目，然后编译部署到真机。</p>

<p>这个时候，在命令行启动 Debug Server 即可：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">react-native start
</code></pre></div></li>
</ul>

<h3 id="结论和后续">结论和后续</h3>

<p>本篇文章，iOS 和 Android 都适用。至此，环境配置和示例项目运行应该都好了。后续我会继续发几篇文章介绍：</p>

<ul>
<li><p>重点介绍 Android 相关的开发：包括组件，源码分析等</p></li>
<li><p>动态热部署</p></li>
<li><p>多端代码复用</p></li>
</ul>

<h4 id="参考文档">参考文档:</h4>

<blockquote>
<p>官方文档：<a href="https://facebook.github.io/react-native/docs/getting-started.html#content">https://facebook.github.io/react-native/docs/getting-started.html#content</a></p>
</blockquote>

<p>时间仓促，水平有限，如有谬误，还请纠正，原始文档在<a href="https://github.com/liaohuqiu/liaohuqiu.github.io/blob/docs/_posts%2Fblog%2F2015%2F2015-09-23-react-native-1.cn.md">这里</a></p>

<p>有问题欢迎留言或在微博上和我交流: <a href="http://weibo.com/liaohuqiu">http://weibo.com/liaohuqiu</a></p>

<hr>

            <hr>
            
            <div class='wechat-mp-qrcode'>
                欢迎关注我的微信公众号<br/>
                <img src='http://www.liaohuqiu.net/assets/img/qrcode_for_wechat_mp.jpg' /><br/>
                <p>欢迎关注我的 <a href='http://weibo.com/liaohuqiu/'>新浪微博</a>，有问题随时交流。</p>
                <p>欢迎关注我的 <a href='https://github.com/liaohuqiu'>GitHub </a>，了解我最新关注的项目。</p>
            </div>
            
            <div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'srain'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

            
        </div>
    </div>
</div>



</body>
</html>
